<template>
  <div :class="className" :style="{height:height,width:width}" />
</template>

<script>
import echarts from 'echarts'
require('echarts/theme/macarons') // echarts theme
import resize from './mixins/resize'

export default {
  mixins: [resize],
  props: {
    className: {
      type: String,
      default: 'chart'
    },
    width: {
      type: String,
      default: '100%'
    },
    height: {
      type: String,
      default: '250px'
    },
    text: {
      type: String,
      default: '文章贡献度'
    },
    subtext: {
      type: String,
      default: '一年内博客提交的数量'
    },
    range: {
      type: Array,
      default: function() {
        return [2020]
      }
    },
    data: {
      type: Array,
      default: function() {
        return [['2020-01-01', 15], ['2020-01-02', 0], ['2020-01-03', 0], ['2020-01-04', 0], ['2020-01-05', 0], ['2020-01-06', 0], ['2020-01-07', 0], ['2020-01-08', 0], ['2020-01-09', 0], ['2020-01-10', 0], ['2020-01-11', 0], ['2020-01-12', 0], ['2020-01-13', 0], ['2020-01-14', 0], ['2020-01-15', 0], ['2020-01-16', 0], ['2020-01-17', 0], ['2020-01-18', 0], ['2020-01-19', 0], ['2020-01-20', 0], ['2020-01-21', 0], ['2020-01-22', 0], ['2020-01-23', 0], ['2020-01-24', 0], ['2020-01-25', 0], ['2020-01-26', 0], ['2020-01-27', 0], ['2020-01-28', 0], ['2020-01-29', 0], ['2020-01-30', 0], ['2020-01-31', 0], ['2020-02-01', 1], ['2020-02-02', 0], ['2020-02-03', 0], ['2020-02-04', 0], ['2020-02-05', 1], ['2020-02-06', 0], ['2020-02-07', 0], ['2020-02-08', 0], ['2020-02-09', 1], ['2020-02-10', 0], ['2020-02-11', 0], ['2020-02-12', 1], ['2020-02-13', 0], ['2020-02-14', 0], ['2020-02-15', 0], ['2020-02-16', 0], ['2020-02-17', 0], ['2020-02-18', 0], ['2020-02-19', 0], ['2020-02-20', 0], ['2020-02-21', 0], ['2020-02-22', 0], ['2020-02-23', 0], ['2020-02-24', 0], ['2020-02-25', 0], ['2020-02-26', 0], ['2020-02-27', 0], ['2020-02-28', 1], ['2020-02-29', 0], ['2020-03-01', 0], ['2020-03-02', 0], ['2020-03-03', 0], ['2020-03-04', 0], ['2020-03-05', 0], ['2020-03-06', 0], ['2020-03-07', 0], ['2020-03-08', 0], ['2020-03-09', 0], ['2020-03-10', 0], ['2020-03-11', 0], ['2020-03-12', 0], ['2020-03-13', 0], ['2020-03-14', 0], ['2020-03-15', 0], ['2020-03-16', 0], ['2020-03-17', 0], ['2020-03-18', 0], ['2020-03-19', 0], ['2020-03-20', 0], ['2020-03-21', 0], ['2020-03-22', 0], ['2020-03-23', 0], ['2020-03-24', 0], ['2020-03-25', 0], ['2020-03-26', 0], ['2020-03-27', 0], ['2020-03-28', 0], ['2020-03-29', 0], ['2020-03-30', 0], ['2020-03-31', 0], ['2020-04-01', 0], ['2020-04-02', 0], ['2020-04-03', 0], ['2020-04-04', 0], ['2020-04-05', 1], ['2020-04-06', 0], ['2020-04-07', 0], ['2020-04-08', 0], ['2020-04-09', 0], ['2020-04-10', 0], ['2020-04-11', 1], ['2020-04-12', 0], ['2020-04-13', 0], ['2020-04-14', 0], ['2020-04-15', 1], ['2020-04-16', 2], ['2020-04-17', 0], ['2020-04-18', 0], ['2020-04-19', 0], ['2020-04-20', 0], ['2020-04-21', 0], ['2020-04-22', 2], ['2020-04-23', 8], ['2020-04-24', 1], ['2020-04-25', 0], ['2020-04-26', 2], ['2020-04-27', 1], ['2020-04-28', 0], ['2020-04-29', 0], ['2020-04-30', 0], ['2020-05-01', 0], ['2020-05-02', 0], ['2020-05-03', 0], ['2020-05-04', 0], ['2020-05-05', 0], ['2020-05-06', 0], ['2020-05-07', 0], ['2020-05-08', 0], ['2020-05-09', 0], ['2020-05-10', 0], ['2020-05-11', 0], ['2020-05-12', 0], ['2020-05-13', 0], ['2020-05-14', 0], ['2020-05-15', 0], ['2020-05-16', 0], ['2020-05-17', 0], ['2020-05-18', 0], ['2020-05-19', 0], ['2020-05-20', 0], ['2020-05-21', 0], ['2020-05-22', 0], ['2020-05-23', 0], ['2020-05-24', 0], ['2020-05-25', 0], ['2020-05-26', 0], ['2020-05-27', 0], ['2020-05-28', 0], ['2020-05-29', 0], ['2020-05-30', 0], ['2020-05-31', 0], ['2020-06-01', 0], ['2020-06-02', 0], ['2020-06-03', 0], ['2020-06-04', 0], ['2020-06-05', 0], ['2020-06-06', 0], ['2020-06-07', 0], ['2020-06-08', 0], ['2020-06-09', 0], ['2020-06-10', 0], ['2020-06-11', 0], ['2020-06-12', 0], ['2020-06-13', 0], ['2020-06-14', 0], ['2020-06-15', 0], ['2020-06-16', 0], ['2020-06-17', 0], ['2020-06-18', 0], ['2020-06-19', 0], ['2020-06-20', 0], ['2020-06-21', 0], ['2020-06-22', 0], ['2020-06-23', 0], ['2020-06-24', 0], ['2020-06-25', 0], ['2020-06-26', 0], ['2020-06-27', 0], ['2020-06-28', 0], ['2020-06-29', 0], ['2020-06-30', 0], ['2020-07-01', 0], ['2020-07-02', 0], ['2020-07-03', 0], ['2020-07-04', 0], ['2020-07-05', 0], ['2020-07-06', 0], ['2020-07-07', 0], ['2020-07-08', 0], ['2020-07-09', 0], ['2020-07-10', 0], ['2020-07-11', 0], ['2020-07-12', 0], ['2020-07-13', 0], ['2020-07-14', 0], ['2020-07-15', 1], ['2020-07-16', 0], ['2020-07-17', 2], ['2020-07-18', 0], ['2020-07-19', 1], ['2020-07-20', 2], ['2020-07-21', 0], ['2020-07-22', 1], ['2020-07-23', 0], ['2020-07-24', 3], ['2020-07-25', 0], ['2020-07-26', 0], ['2020-07-27', 0], ['2020-07-28', 1], ['2020-07-29', 1], ['2020-07-30', 1], ['2020-07-31', 0]]
      }
    }
  },
  data() {
    return {
      chart: null
    }
  },
  mounted() {
    this.$nextTick(() => {
      this.initChart()
    })
  },
  beforeDestroy() {
    if (!this.chart) {
      return
    }
    this.chart.dispose()
    this.chart = null
  },
  methods: {
    initChart() {
      this.chart = echarts.init(this.$el, 'macarons')

      this.chart.setOption({
        // 标题组件，包含主标题和副标题。
        title: {
          top: 20,
          text: this.text, // 主标题
          subtext: this.subtext, // 副标题
          left: 'center',
          textStyle: { // 主标题样式
            color: '#000'
          }
        },
        // 提示框组件
        tooltip: {
          trigger: 'item', // 触发类型
          formatter: function(params) { // 提示框浮层内容格式器
            return (params.data[1] + '个贡献：' + params.data[0])
          }
        },
        // 日历坐标系组件
        calendar: [{
          top: 100,
          bottom: 10,
          left: 'center',
          range: this.range, // 日历坐标的范围 支持多种格式
          // 月份分隔线样式
          splitLine: { show: false },
          // 设置日历坐标中 年份的样式
          yearLabel: { show: false },
          dayLabel: { // 设置日历坐标中 星期轴的样式
            firstDay: 1, // 从周一开始
            nameMap: ['周日', '周一', '', '', '周四', '', ''], // 设置中文显示
            textStyle: {
              // 设置周显示颜色
              color: '#000'
            }
          },
          // 设置日历坐标中 月份轴的样式
          monthLabel: {
            nameMap: 'cn', // 设置中文显示
            textStyle: {
              // 设置月显示颜色
              color: '#000'
            }
          },
          // 设置日历格的样式
          itemStyle: {
            normal: {
              // 设置背景颜色
              color: '#ebedf0',
              borderWidth: 3, // 线宽
              // 设置分割线段颜色
              borderColor: '#ffffff'
            }
          }
        }],
        series: [
          {
            type: 'scatter', // https://echarts.apache.org/zh/option.html#series-scatter
            coordinateSystem: 'calendar', // 该系列使用的坐标系
            hoverAnimation: false, // 是否开启鼠标 hover 的提示动画效果。
            data: this.data,
            // 标记的图形
            symbol: 'rect',
            // 大小
            symbolSize: 16,
            itemStyle: { // 图形样式
              normal: {
                // 设置颜色
                color: function(val) {
                  console.log(val.value)
                  if (val.value[1] === 0) {
                    return '#ebedf0'
                  } else if (val.value[1] > 0 && val.value[1] <= 2) {
                    return '#9be9a8'
                  } else if (val.value[1] > 2 && val.value[1] <= 5) {
                    return '#40c463'
                  } else if (val.value[1] > 5 && val.value[1] <= 10) {
                    return '#30a14e'
                  } else if (val.value[1] > 10) {
                    return '#216e39'
                  }
                }
              }
            }
          }
        ]
      })
    }
  }
}
</script>
